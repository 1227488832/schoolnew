"use strict";(self["webpackChunkschoolactivities"]=self["webpackChunkschoolactivities"]||[]).push([[438],{5438:function(a,t,i){i.r(t),i.d(t,{default:function(){return g}});var e=function(){var a=this,t=a._self._c;return t("div",{attrs:{id:"updata"}},[t("div",{staticClass:"home_container"},[t("div",{staticClass:"iconback"},[t("van-icon",{attrs:{name:"arrow-left"},on:{click:a.back}})],1),a._m(0),t("div",{staticClass:"title"},[a._v("上传游戏信息")]),t("div",{staticClass:"home_form"},[t("van-field",{attrs:{label:"游戏ID:"},model:{value:a.userForm.gameId,callback:function(t){a.$set(a.userForm,"gameId",t)},expression:"userForm.gameId"}}),t("van-field",{attrs:{label:"游戏段位:"},model:{value:a.userForm.gameValue,callback:function(t){a.$set(a.userForm,"gameValue",t)},expression:"userForm.gameValue"}})],1),t("div",{staticClass:"uploader"},[a.loadimg?t("div",{staticClass:"uploader_img"},[t("img",{attrs:{src:a.loadimg,alt:""}})]):t("van-uploader",{attrs:{"after-read":a.afterRead}},[t("div",{staticClass:"upload-bg"}),t("div",{staticClass:"updatabtn"},[a._v("上传游戏截图")])])],1),a._m(1),t("div",{staticClass:"back",staticStyle:{"margin-bottom":"0.2rem"}},[t("div",{on:{click:a.goto}},[a._v("确认上传")])]),t("van-popup",{model:{value:a.dialogValue,callback:function(t){a.dialogValue=t},expression:"dialogValue"}},[t("div",{staticClass:"dialog_info"},[t("div",{staticClass:"dialog_info_cont"},[t("p",[a._v("您的游戏ID:")]),t("span",[a._v("哈哈哈")])]),t("div",{staticClass:"dialog_info_cont"},[t("p",[a._v("您的游戏段位:")]),t("span",[a._v("哈哈哈")])])]),t("div",{staticClass:"dialog_img"},[t("img",{attrs:{src:a.loadimg,alt:""}})]),t("div",{staticClass:"dialog_tis"},[a._v("请将此页面出示给现场工作人员兑换奖品！")]),t("div",{staticClass:"dialog_back"},[t("div",{on:{click:a.confirm}},[a._v("确定")])])]),a.loadingData?a._e():t("van-loading",{attrs:{type:"spinner",size:"24px"}},[a._v("加载中...")])],1)])},s=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"home_title"},[t("div",{staticClass:"line"}),t("div",[a._v("雀巢咖啡，提醒每一天")]),t("div",{staticClass:"line"})])},function(){var a=this,t=a._self._c;return t("div",{staticClass:"tix"},[t("p",[a._v("每位ID限量只能领取一次奖励！重复领取无效")]),t("p",[a._v("最终解释权归现场活动人员所有")])])}],l=(i(7658),i(5214)),o=i(70),n={data(){return{userForm:{gameId:"",gameValue:""},dialogValue:!1,updataimg:{cont:"",name:"",lastModified:""},picdata:{recognize_id:"",recognize_level:"",img_uri:""},file:null,loadingData:!0,loadimg:!1}},methods:{back(){this.$router.push("/pagefive")},afterRead(a){this.loadingData=!1,console.log(a),this.file=a,this.updataimg.lastModified=a.file.type,this.updataimg.cont=a.content;let t="wUbxngjGDBUEsS-kulRcXh2Jp-9dXkVM",i="gxcRJD0wqwVElf2OemeFMLWqLIo9ywNR",e=a.content,s=new FormData;s.append("api_key",t),s.append("api_secret",i),s.append("image_base64",e),(0,o.ZP)({url:"https://api-cn.faceplusplus.com/imagepp/v2/generalocr",method:"post",data:s}).then((a=>{if(console.log(a),200==a.status){this.loadimg=this.updataimg.cont,this.loadingData=!0;let s=a.data.text_info;console.log(s);let l=s[s.length-5].line_content.indexOf("我的排名");if(0==l){console.log(s[s.length-4].line_content),console.log(s[s.length-1].line_content);let l=s[s.length-1].line_content;var t=l,i=/[\u4e00-\u9fa5]/g,e=t.match(i);t=e.join(""),console.log(t),this.picdata.recognize_level=t,this.picdata.recognize_id=a.data.request_id}}}))},confirm(){this.dialogValue=!1},async goto(a){if(console.log(a),this.loadingData=!1,""==this.userForm.gameId)return this.Toast("请输入游戏ID"),void(this.loadingData=!0);if(""==this.userForm.gameValue)return this.Toast("请输入段位"),void(this.loadingData=!0);if(""==this.picdata.recognize_id)return this.Toast("请先上传图片"),void(this.loadingData=!0);let t=await(0,l.WA)(),i=t.data.data;console.log(i);const e=new FormData,s=this.file.file.name;e.append("name",`${(new Date).getTime()}${s}`),e.append("key",i.dir+s),e.append("policy",i.policy),e.append("OSSAccessKeyId",i.accessid),e.append("callback",i.callback),e.append("signature",i.signature),e.append("file",this.file.file),console.log(this.file);await(0,l.F_)(i.host,e).then((a=>{console.log(a),200==a.data.status&&(this.picdata.img_uri=a.data.data.filename)}));(0,l.FF)({game_id:this.userForm.gameId,game_level:this.userForm.gameValue,recognize_id:this.picdata.recognize_id,recognize_level:this.picdata.recognize_level,img_uri:this.picdata.img_uri}).then((a=>{console.log(a),this.loadingData=!0,200==a.data.status?this.dialogValue=!0:this.Toast(a.data.msg)}))}}},d=n,c=i(1001),r=(0,c.Z)(d,e,s,!1,null,"de3d8f7c",null),g=r.exports}}]);
//# sourceMappingURL=438.3674f0e6.js.map